name: Tag Notification

on:
  push:
    tags:
      - '*'

jobs:
  notify:
    runs-on: ubuntu-latest
    permissions:
      issues: write
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Get tag info
        id: tag
        run: |
          TAG_NAME="${GITHUB_REF#refs/tags/}"
          echo "name=$TAG_NAME" >> "$GITHUB_OUTPUT"
          COMMIT_MSG=$(git log -1 --format='%s' "$TAG_NAME" 2>/dev/null || echo "No commit message")
          echo "commit_msg=$COMMIT_MSG" >> "$GITHUB_OUTPUT"

      - name: Create issue
        uses: actions/github-script@v7
        with:
          script: |
            await github.rest.issues.create({
              owner: context.repo.owner,
              repo: context.repo.repo,
              title: `New tag: ${process.env.TAG_NAME}`,
              body: `Tag **${process.env.TAG_NAME}** was created.\n\nCommit: ${process.env.COMMIT_MSG}\nPushed by: @${context.actor}`,
              labels: ['release']
            });
        env:
          TAG_NAME: ${{ steps.tag.outputs.name }}
          COMMIT_MSG: ${{ steps.tag.outputs.commit_msg }}
